!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("@fr0st/ui"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/query"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.UI,t.fQuery)}(this,(function(t,s,e){"use strict";class i extends s.BaseComponent{constructor(t,s){super(t,s),this._options.uploadCallback||(this._options.showUpload=!1),this._options.cancelCallback||(this._options.showCancel=!1),this._options.removeCallback||(this._options.showRemove=!1),this._options.initialValue?this._fileList=e._wrap(this._options.initialValue):this._fileList=[],this._render(),this._events(),this._refresh(),this._refreshDisabled()}clear(){e.setValue(this._node,null),this._refresh()}disable(){e.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){e.remove(this._container),e.removeEvent(this._node,"change.ui.fileinput"),e.removeAttribute(this._node,"tabindex"),e.removeClass(this._node,this.constructor.classes.hide),this._container=null,this._group=null,this._input=null,this._fileNames=null,this._uploadButton=null,this._cancelButton=null,this._removeButton=null,this._browseButton=null,this._progress=null,this._progressBar=null,this._fileList=null,super.dispose()}enable(){e.removeAttribute(this._node,"disabled"),this._refreshDisabled()}getFiles(){const t=e.getProperty(this._node,"files"),s=[];for(const e of t)s.push(e);return s}static _renderButton(t,s){const i=e.create("button",{class:[this.classes.btn,`btn-${t}`],text:this.lang[s],attributes:{type:"button"}}),o=e.create("div",{class:this.classes.icon,html:this.icons[s]});return e.prepend(i,o),i}}i.defaults={uploadCallback:null,cancelCallback:null,removeCallback:null,initialValue:null,inputStyle:"filled",browseStyle:"secondary",removeStyle:"light",uploadStyle:"primary",cancelStyle:"danger",multiSeparator:", ",showBrowse:!0,showUpload:!0,showCancel:!0,showRemove:!0,showProgress:!0},i.classes={btn:"btn",btnGroup:"btn-group",fileNames:"align-middle ms-2",formInput:"form-input",hide:"visually-hidden",icon:"d-inline-block me-1",inputFilled:"input-filled",inputOutline:"input-outline",inputGroup:"input-group",inputGroupFilled:"input-group-filled",progress:"progress mt-1",progressBar:"progress-bar",progressError:"bg-danger",progressSuccess:"bg-success",spinner:"spinner-border spinner-border-sm"},i.icons={browse:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19 20H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h7a2 2 0 0 1 2 2H4v10l2.14-8h17.07l-2.28 8.5c-.23.87-1.01 1.5-1.93 1.5z" fill="currentColor"/></svg>',cancel:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M20 6.91L17.09 4L12 9.09L6.91 4L4 6.91L9.09 12L4 17.09L6.91 20L12 14.91L17.09 20L20 17.09L14.91 12L20 6.91z" fill="currentColor"/></svg>',remove:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M20 6.91L17.09 4L12 9.09L6.91 4L4 6.91L9.09 12L4 17.09L6.91 20L12 14.91L17.09 20L20 17.09L14.91 12L20 6.91z" fill="currentColor"/></svg>',upload:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9 16v-6H5l7-7l7 7h-4v6H9m-4 4v-2h14v2H5z" fill="currentColor"/></svg>'},i.lang={browse:"Browse",cancel:"Cancel",remove:"Remove",selectFiles:"Select files ...",selectFile:"Select file ...",upload:"Upload",uploadFailed:"Upload failed",uploadSuccess:"Upload success"};const o=i.prototype;o._endLoading=function(){e.removeAttribute(this._node,"disabled");const t=this._getButtons();for(const s of t){if(!e.hasDataset(s,"uiContent"))continue;e.removeAttribute(s,"disabled");const t=e.getDataset(s,"uiContent");e.setHTML(s,t),e.append(this._group,s)}this._refresh()},o._events=function(){if(e.addEvent(this._node,"change.ui.fileinput",(t=>{this._refresh()})),e.addEvent(this._container,"dragover.ui.fileinput",(t=>{t.preventDefault()})),e.addEvent(this._container,"drop.ui.fileinput",(t=>{t.preventDefault(),e.setProperty(this._node,{files:t.dataTransfer.files}),this._refresh()})),e.addEvent(this._input,"focus.ui.fileinput",(t=>{e.blur(this._input)})),e.addEvent(this._input,"click.ui.fileinput",(t=>{e.click(this._node)})),this._uploadButton){const t=this._options.uploadCallback.bind(this),s=t=>{t=Math.round(t),this._progressBar&&(e.setText(this._progressBar,`${t}%`),e.setStyle(this._progressBar,{width:`${t}%`}))};e.addEvent(this._uploadButton,"click.ui.fileinput",(i=>{this._startLoading(this._uploadButton),this._cancelButton&&e.append(this._group,this._cancelButton),this._progress&&e.append(this._container,this._progress),this._progressBar&&e.removeClass(this._progressBar,[this.constructor.classes.progressSuccess,this.constructor.classes.progressError]),Promise.resolve(t(s)).then((t=>{this._fileList=this._getFileNames(),e.setValue(this._node,""),e.triggerEvent(this._node,"change.ui.fileinput"),e.detach(this._uploadButton),this._progressBar&&(e.setText(this._progressBar,this.constructor.lang.uploadSuccess),e.addClass(this._progressBar,this.constructor.classes.progressSuccess))})).catch((t=>{this._progressBar&&(e.setText(this._progressBar,this.constructor.lang.uploadFail),e.addClass(this._progressBar,this.constructor.classes.progressError))})).finally((t=>{this._endLoading(),this._progressBar&&e.setStyle(this._progressBar,{width:"100%"})}))}))}if(this._cancelButton){const t=this._options.cancelCallback.bind(this);e.addEvent(this._cancelButton,"click.ui.fileinput",(s=>{this._startLoading(this._cancelButton),Promise.resolve(t()).then((t=>{this._progressBar&&e.setStyle(this._progressBar,{width:"0%"})})).finally((t=>{this._endLoading(),this._progress&&e.detach(this._progress)}))}))}if(this._removeButton){const t=this._options.removeCallback.bind(this);e.addEvent(this._removeButton,"click.ui.fileinput",(s=>{this._startLoading(this._removeButton),Promise.resolve(t()).then((t=>{this._fileList=[],e.getProperty(this._node,"files")&&(e.setValue(this._node,""),e.triggerEvent(this._node,"change.ui.fileinput"))})).finally((t=>{this._endLoading(),this._progress&&e.detach(this._progress)}))}))}this._browseButton&&e.addEvent(this._browseButton,"click.ui.fileinput",(t=>{e.click(this._node)}))},o._getButtons=function(){return[this._uploadButton,this._cancelButton,this._removeButton,this._browseButton].filter((t=>t))},o._getFileNames=function(){return this.getFiles().map((t=>t.name))},o._refresh=function(){const t=this.getFiles().length>0;let s;s=t?this._getFileNames():this._fileList,s=s.join(this._options.multiSeparator),this._input?e.setValue(this._input,s):e.setText(this._fileNames,s),this._uploadButton&&(t?e.append(this._group,this._uploadButton):e.detach(this._uploadButton)),this._cancelButton&&e.detach(this._cancelButton),this._removeButton&&(s?e.append(this._group,this._removeButton):e.detach(this._removeButton)),this._browseButton&&e.append(this._group,this._browseButton)},o._refreshDisabled=function(){const t=this._getButtons();this._input&&t.push(this._input),e.is(this._node,":disabled")?e.setAttribute(t,{disabled:!0}):e.removeAttribute(t,"disabled")},o._render=function(){if(this._container=e.create("div"),"none"===this._options.inputStyle)this._group=e.create("div",{class:this.constructor.classes.btnGroup}),this._fileNames=e.create("small",{class:this.constructor.classes.fileNames});else{this._group=e.create("div",{class:this.constructor.classes.inputGroup});const t=e.create("div",{class:this.constructor.classes.formInput});this._input=e.create("input",{attributes:{type:"text",placeholder:e.is(this._node,"[multiple]")?this.constructor.lang.selectFiles:this.constructor.lang.selectFile,tabindex:-1}}),"filled"===this._options.inputStyle?(e.addClass(this._input,this.constructor.classes.inputFilled),e.addClass(this._group,this.constructor.classes.inputGroupFilled)):e.addClass(this._input,this.constructor.classes.inputOutline),e.append(t,this._input),e.append(this._group,t)}this._options.showUpload&&(this._uploadButton=this.constructor._renderButton(this._options.uploadStyle,"upload")),this._options.showCancel&&(this._cancelButton=this.constructor._renderButton(this._options.cancelStyle,"cancel")),this._options.showRemove&&(this._removeButton=this.constructor._renderButton(this._options.removeStyle,"remove")),this._options.showBrowse&&(this._browseButton=this.constructor._renderButton(this._options.browseStyle,"browse")),e.append(this._container,this._group),this._fileNames&&e.append(this._container,this._fileNames),this._options.showProgress&&(this._progress=e.create("div",{class:this.constructor.classes.progress}),this._progressBar=e.create("div",{class:this.constructor.classes.progressBar}),e.append(this._progress,this._progressBar)),e.setAttribute(this._node,{tabindex:-1}),e.addClass(this._node,this.constructor.classes.hide),e.before(this._node,this._container)},o._startLoading=function(t){this._node&&e.setAttribute(this._node,{disabled:!0});const s=this._getButtons();if(e.detach(s),t){e.setAttribute(t,{disabled:!0});const s=e.getHTML(t);e.setDataset(t,{uiContent:s});const i=e.create("span",{class:this.constructor.classes.spinner});e.empty(t),e.append(t,i),e.append(this._group,t)}},s.initComponent("fileinput",i),t.FileInput=i}));